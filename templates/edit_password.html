{% extends "base.html" %}
{% block content %}
<style>
    .glass-card {
        background: rgba(255, 255, 255, 0.07);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        border-radius: 12px;
        padding: 30px;
        max-width: 600px;
        margin: auto;
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }
    .form-floating input {
        background: rgba(255, 255, 255, 0.08) !important;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 6px;
        color: #fff;
        padding-left: 10px;
    }
    .form-floating input:focus {
        background: rgba(255, 255, 255, 0.12) !important;
        border-color: #6c63ff;
        box-shadow: 0 0 5px rgba(108, 99, 255, 0.5);
        color: #fff;
    }
    .form-floating label { color: rgba(255, 255, 255, 0.75); }
    .progress { height: 8px; border-radius: 4px; background-color: rgba(255, 255, 255, 0.1); }
    .btn-custom {
        background: linear-gradient(135deg, #6c63ff, #3b82f6);
        border: none;
        color: #fff;
        font-weight: 600;
        transition: 0.3s;
    }
    .btn-custom:hover { background: linear-gradient(135deg, #5a54d6, #2563eb); transform: scale(1.04); }
</style>

<div class="glass-card mt-5">
    <h2 class="text-center mb-3">Edit <span style="color:#6c63ff;">Password</span></h2>
    <p class="text-center text-light mb-4">Update your credentials securely in Vaultify.</p>

    <form method="POST" action="/edit_password/{{ item._id }}">
        <div class="form-floating mb-3">
            <input type="text" name="account" id="account" class="form-control" value="{{ item.account }}" required>
            <label for="account">Account/Website</label>
        </div>

        <div class="form-floating mb-3">
            <input type="text" name="username" id="username" class="form-control" value="{{ item.username }}" required>
            <label for="username">Username/Email</label>
        </div>

        <div class="mb-3">
            <label for="password" class="form-label text-light">Password</label>
            <div class="input-group">
                <input type="text" name="password" id="password" class="form-control" value="{{ item.password }}" required>
                <button type="button" class="btn btn-outline-light" onclick="generatePassword()">Generate</button>
                <button type="button" class="btn btn-outline-light" onclick="copyPassword()">Copy</button>
            </div>
            <div class="progress mt-2">
                <div id="strength-bar" class="progress-bar bg-danger" style="width: 0%;"></div>
            </div>
            <small id="strength-text" class="text-light">Strength: Weak</small>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-custom btn-lg px-5">Update Password</button>
        </div>
    </form>
</div>

<script>
    const passwordField = document.getElementById("password");
    const strengthBar = document.getElementById("strength-bar");
    const strengthText = document.getElementById("strength-text");

    function checkStrength() {
        const val = passwordField.value;
        let strength = 0;
        if (val.match(/[a-z]+/)) strength += 1;
        if (val.match(/[A-Z]+/)) strength += 1;
        if (val.match(/[0-9]+/)) strength += 1;
        if (val.match(/[$@#&!]+/)) strength += 1;
        if (val.length >= 8) strength += 1;

        switch (strength) {
            case 0:
            case 1:
                strengthBar.style.width = "20%";
                strengthBar.className = "progress-bar bg-danger";
                strengthText.innerText = "Strength: Very Weak";
                break;
            case 2:
                strengthBar.style.width = "40%";
                strengthBar.className = "progress-bar bg-warning";
                strengthText.innerText = "Strength: Weak";
                break;
            case 3:
                strengthBar.style.width = "60%";
                strengthBar.className = "progress-bar bg-info";
                strengthText.innerText = "Strength: Medium";
                break;
            case 4:
                strengthBar.style.width = "80%";
                strengthBar.className = "progress-bar bg-primary";
                strengthText.innerText = "Strength: Strong";
                break;
            case 5:
                strengthBar.style.width = "100%";
                strengthBar.className = "progress-bar bg-success";
                strengthText.innerText = "Strength: Very Strong";
                break;
        }
    }
    passwordField.addEventListener("input", checkStrength);

    function generatePassword() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@$!%*?&";
        let password = "";
        for (let i = 0; i < 12; i++) {
            password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        passwordField.value = password;
        passwordField.dispatchEvent(new Event('input'));
    }

    function copyPassword() {
        passwordField.select();
        document.execCommand("copy");
        alert("Password copied to clipboard!");
    }
    checkStrength();
</script>
{% endblock %}
